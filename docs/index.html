<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>AR –ò–≥—Ä–æ–≤—ã–µ –§–∏–≥—É—Ä—ã</title>
    <meta name="description" content="AR –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö —Ñ–∏–≥—É—Ä —Å –∫–∞–º–µ—Ä–æ–π">
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="stylesheet" href="index.css">
    <script src="./packed.js" defer></script>
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ -->
    <button id="startButton">üéÆ –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading">
        <div class="spinner"></div>
        <div id="loadingText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ AR...</div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
    <div id="errorMessage"></div>
    
    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
    <div id="instructions">
        <div class="instructions-content">
            <div class="instructions-title">üîç –ò—â–µ–º –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å...</div>
            <div class="instructions-steps">
                1. –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ <strong>—Ä–æ–≤–Ω—ã–π —Å—Ç–æ–ª –∏–ª–∏ –ø–æ–ª</strong><br>
                2. –ú–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–≥–∞–π—Ç–µ –∫–∞–º–µ—Ä–æ–π –∏–∑ —Å—Ç–æ—Ä–æ–Ω—ã –≤ —Å—Ç–æ—Ä–æ–Ω—É<br>
                3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ—è–≤–ª–µ–Ω–∏—è —Ñ–∏–≥—É—Ä—ã
            </div>
            <div id="surfaceStatus" class="surface-status">
                –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏...
            </div>
            <div class="instructions-tip">
                <small>–ï—Å–ª–∏ —Ñ–∏–≥—É—Ä–∞ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ª—É—á—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ</small>
            </div>
        </div>
    </div>
    
    <!-- –õ–æ–≥–æ—Ç–∏–ø Snapchat -->
    <div class="poweredbysnap-logo">
        <img src="./assets/Powered_bysnap.png" alt="Powered by Snap">
    </div>
    
    <!-- Canvas –¥–ª—è AR -->
    <canvas id="canvas"></canvas>
    
    <!-- –¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ -->
    <button id="testCameraButton" class="test-button">
        üì∑ –¢–µ—Å—Ç –∫–∞–º–µ—Ä—ã
    </button>
    
    <!-- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ -->
    <button id="restartButton" class="restart-button">
        üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å AR
    </button>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.testCameraOnly = async function() {
            try {
                document.getElementById('testCameraButton').style.display = 'none';
                document.getElementById('loading').style.display = 'block';
                document.getElementById('loadingText').textContent = '–¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–∞–º–µ—Ä—É...';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                const video = document.createElement('video');
                video.srcObject = stream;
                video.autoplay = true;
                video.muted = true;
                video.playsInline = true;
                video.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 9998;
                    object-fit: cover;
                `;
                document.body.appendChild(video);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('errorMessage').innerHTML = `
                    <div style="color: #00FF00;">
                        ‚úÖ –ö–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!<br>
                        <small>–í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ –≤—ã—à–µ. –ó–∞–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ.</small>
                    </div>
                `;
                document.getElementById('errorMessage').style.display = 'block';
                
                // –£–¥–∞–ª—è–µ–º –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (video.parentNode) {
                        video.parentNode.removeChild(video);
                    }
                    document.getElementById('testCameraButton').style.display = 'block';
                    document.getElementById('errorMessage').style.display = 'none';
                }, 10000);
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('testCameraButton').style.display = 'block';
                
                let message = '‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: ';
                if (error.name === 'NotAllowedError') {
                    message = '–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                } else if (error.name === 'NotFoundError') {
                    message = '–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –∏–º–µ–µ—Ç –∫–∞–º–µ—Ä—ã –∏–ª–∏ –æ–Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞.';
                } else {
                    message = error.message;
                }
                
                document.getElementById('errorMessage').textContent = message;
                document.getElementById('errorMessage').style.display = 'block';
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                document.getElementById('startButton').disabled = true;
                document.getElementById('startButton').textContent = '‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
                document.getElementById('errorMessage').textContent = 
                    '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome –Ω–∞ Android –∏–ª–∏ Safari –Ω–∞ iOS.';
                document.getElementById('errorMessage').style.display = 'block';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
            if (!window.isSecureContext && window.location.hostname !== 'localhost' && 
                window.location.hostname !== '127.0.0.1') {
                document.getElementById('errorMessage').innerHTML = 
                    '‚ö†Ô∏è –î–ª—è —Ä–∞–±–æ—Ç—ã AR —Ç—Ä–µ–±—É–µ—Ç—Å—è HTTPS.<br>' +
                    '<small>GitHub Pages –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS.</small>';
                document.getElementById('errorMessage').style.display = 'block';
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('testCameraButton').addEventListener('click', window.testCameraOnly);
            document.getElementById('restartButton').addEventListener('click', function() {
                if (window.stopAR) {
                    window.stopAR();
                }
                document.getElementById('startButton').style.display = 'block';
                document.getElementById('canvas').style.display = 'none';
                document.getElementById('instructions').style.display = 'none';
                document.getElementById('restartButton').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'none';
            });
            
            // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            document.getElementById('testCameraButton').style.display = 'none';
            document.getElementById('restartButton').style.display = 'none';
        });
    </script>
</body>
</html>
