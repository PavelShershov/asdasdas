<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>AR Game Figures</title>
    <meta name="description" content="AR –∏–≥—Ä–æ–≤—ã–µ —Ñ–∏–≥—É—Ä—ã —Å –∫–∞–º–µ—Ä–æ–π">
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    
    <link href="index.css" rel="stylesheet">
    <style>
      /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
      #startButton {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px 40px;
        font-size: 24px;
        background: #FFFC00;
        color: black;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        z-index: 1000;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: transform 0.2s;
      }
      
      #startButton:hover {
        transform: translate(-50%, -50%) scale(1.05);
      }
      
      #startButton:active {
        transform: translate(-50%, -50%) scale(0.95);
      }
      
      /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
      #loading {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        z-index: 999;
      }
      
      .spinner {
        border: 4px solid rgba(255,255,255,0.3);
        border-top: 4px solid #FFFC00;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ */
      #errorMessage {
        display: none;
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        background: rgba(255,0,0,0.9);
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 1001;
        text-align: center;
      }
      
      /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */
      #instructions {
        display: none;
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 100;
        text-align: center;
        font-size: 14px;
      }
    </style>
    <script src="./packed.js"></script>
  </head>

  <body>
    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ AR -->
    <button id="startButton">üéÆ –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading">
      <div class="spinner"></div>
      <div>–ó–∞–≥—Ä—É–∑–∫–∞ AR...</div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
    <div id="errorMessage"></div>
    
    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
    <div id="instructions">
      –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —Ä–æ–≤–Ω—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å (—Å—Ç–æ–ª, –ø–æ–ª). –§–∏–≥—É—Ä–∞ –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    </div>
    
    <!-- –õ–æ–≥–æ—Ç–∏–ø Snapchat -->
    <div class="poweredbysnap-logo">
      <img id="image" src="./assets/Powered_bysnap.png" alt="Powered by Snap">
    </div>
    
    <!-- Canvas –¥–ª—è AR (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
    <canvas id="canvas" style="display: none;"></canvas>
    
    <!-- –í–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç -->
    <video id="video" style="display: none;" autoplay muted playsinline></video>
    
    <script>
      // –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —É–∂–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º packed.js
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏
      document.addEventListener('DOMContentLoaded', function() {
        const startButton = document.getElementById('startButton');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const canvas = document.getElementById('canvas');
        const instructions = document.getElementById('instructions');
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–∞–º–µ—Ä—ã
        function checkCameraSupport() {
          return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ HTTPS
        function isSecureContext() {
          return window.location.protocol === 'https:' || 
                 window.location.hostname === 'localhost' || 
                 window.location.hostname === '127.0.0.1';
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (!checkCameraSupport()) {
          errorMessage.textContent = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–º–µ—Ä—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä.';
          errorMessage.style.display = 'block';
          startButton.disabled = true;
          startButton.textContent = '‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
        }
        
        if (!isSecureContext() && window.location.hostname !== 'localhost') {
          errorMessage.textContent = '–¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS. –û—Ç–∫—Ä–æ–π—Ç–µ https://' + window.location.host;
          errorMessage.style.display = 'block';
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
        startButton.addEventListener('click', async function() {
          startButton.style.display = 'none';
          loading.style.display = 'block';
          
          try {
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É
            const stream = await navigator.mediaDevices.getUserMedia({
              video: {
                facingMode: 'environment',
                width: { ideal: 1280 },
                height: { ideal: 720 }
              }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
            instructions.style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loading.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º canvas (–µ—Å–ª–∏ packed.js –µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑–∞–ª)
            canvas.style.display = 'block';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ç–æ–∫ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            window.cameraStream = stream;
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ AR, –≤—ã–∑—ã–≤–∞–µ–º –µ—ë
            if (window.startAR) {
              window.startAR(stream);
            }
            
          } catch (error) {
            console.error('Camera error:', error);
            loading.style.display = 'none';
            startButton.style.display = 'block';
            
            let message = '–û—à–∏–±–∫–∞: ';
            switch(error.name) {
              case 'NotAllowedError':
                message = '–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –∫–∞–º–µ—Ä—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                break;
              case 'NotFoundError':
                message = '–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–º–µ—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∏ –Ω–µ –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.';
                break;
              case 'NotReadableError':
                message = '–ö–∞–º–µ—Ä–∞ –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∫–∞–º–µ—Ä—É.';
                break;
              default:
                message = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ: ' + error.message;
            }
            
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
          }
        });
        
        // –ê–≤—Ç–æ-–ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Ä–∞–∑—Ä–µ—à–∏–ª –∫–∞–º–µ—Ä—É —Ä–∞–Ω–µ–µ
        navigator.permissions && navigator.permissions.query({ name: 'camera' })
          .then(function(permissionStatus) {
            if (permissionStatus.state === 'granted') {
              startButton.textContent = 'üéÆ –ö–∞–º–µ—Ä–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ - –ó–∞–ø—É—Å—Ç–∏—Ç—å AR';
            }
            permissionStatus.onchange = function() {
              if (this.state === 'granted') {
                startButton.textContent = 'üéÆ –ö–∞–º–µ—Ä–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ - –ó–∞–ø—É—Å—Ç–∏—Ç—å AR';
              }
            };
          });
      });
    </script>
  </body>
</html>
